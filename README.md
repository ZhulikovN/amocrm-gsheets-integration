# AmoCRM ‚Üî Google Sheets Integration

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

**AmoCRM-GSheets-Integration** ‚Äî —ç—Ç–æ FastAPI-—Å–µ—Ä–≤–∏—Å, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é **–¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—é—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é** –¥–∞–Ω–Ω—ã—Ö
–º–µ–∂–¥—É Google Sheets –∏ AmoCRM.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∏ —Å–¥–µ–ª–æ–∫** –≤ AmoCRM –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–æ–∫ –≤ Google Sheets
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ** –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–¥–µ–ª–æ–∫ –≤ AmoCRM
- **–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤** —Å –ø–æ–º–æ—â—å—é Redis-–±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
- **–£–º–Ω—ã–π –ø–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤** –ø–æ email, —Ç–µ–ª–µ—Ñ–æ–Ω—É –∏ –∏–º–µ–Ω–∏
- **–ê–≤—Ç–æ–∏–º–ø–æ—Ä—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç—Ä–æ–∫** –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **Rate limiting** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ API
- **Retry-–º–µ—Ö–∞–Ω–∏–∑–º—ã** –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **Google Sheets ‚Üí AmoCRM:**
    - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç/—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü–µ
    - Google Apps Script –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    - –°–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç –∏ —Å–¥–µ–ª–∫—É –≤ AmoCRM
    - ID —Å–¥–µ–ª–∫–∏ –∏ —Å—Å—ã–ª–∫–∞ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ç–∞–±–ª–∏—Ü—É

2. **AmoCRM ‚Üí Google Sheets:**
    - –ú–µ–Ω–µ–¥–∂–µ—Ä –º–µ–Ω—è–µ—Ç —Å–¥–µ–ª–∫—É –≤ AmoCRM (—Å—Ç–∞—Ç—É—Å, –±—é–¥–∂–µ—Ç)
    - AmoCRM –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    - –°–µ—Ä–≤–µ—Ä –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü–µ

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤

```
amocrm-gsheets-integration/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ main.py                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∑–∞–ø—É—Å–∫ FastAPI
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ api/                       # API endpoints (–≤–µ–±—Ö—É–∫–∏)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ health.py              # Health check endpoint
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ webhook_amocrm.py      # POST /webhook/amocrm
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ webhook_sheets.py      # POST /webhook/sheets
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ core/                      # –ù–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ –∫–ª–∏–µ–Ω—Ç—ã –∏ —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ settings.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (Pydantic Settings)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ amocrm_client.py       # –ö–ª–∏–µ–Ω—Ç –¥–ª—è AmoCRM API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sheets_client.py       # –ö–ª–∏–µ–Ω—Ç –¥–ª—è Google Sheets API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sync_lock.py           # Redis-–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –≥–æ–Ω–æ–∫
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils.py               # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (normalize_phone, make_external_id)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ services/                  # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ amocrm_service.py      # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤ –æ—Ç AmoCRM
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sheets_service.py      # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤ –æ—Ç Google Sheets
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ import_service.py      # –ê–≤—Ç–æ–∏–º–ø–æ—Ä—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç—Ä–æ–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ models/                    # Pydantic –º–æ–¥–µ–ª–∏
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îî‚îÄ‚îÄ webhook_row.py         # –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö –≤–µ–±—Ö—É–∫–∞
‚îÇ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ apps_script.js             # Google Apps Script –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤
‚îÇ
‚îú‚îÄ‚îÄ secrets/
‚îÇ   ‚îî‚îÄ‚îÄ *.json                     # –°–µ–∫—Ä–µ—Ç—ã Google Service Account (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è)
‚îÇ
‚îú‚îÄ‚îÄ tests/                         # –¢–µ—Å—Ç—ã (pytest)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ test_utils.py
‚îÇ
‚îú‚îÄ‚îÄ .env                           # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è)
‚îú‚îÄ‚îÄ .pylintrc                      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Pylint
‚îú‚îÄ‚îÄ docker-compose.yml             # Docker Compose –¥–ª—è Redis
‚îú‚îÄ‚îÄ Makefile                       # –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ª–∏–Ω—Ç–∏–Ω–≥–∞
‚îú‚îÄ‚îÄ pyproject.toml                 # Poetry –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ README.md                      # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

### –û–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π

#### `app/main.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è FastAPI
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–æ–≤ (`/webhook/sheets`, `/webhook/amocrm`, `/health`)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- **–ê–≤—Ç–æ–∏–º–ø–æ—Ä—Ç —Å—Ç—Ä–æ–∫** –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (`import_existing_rows()`)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π startup/shutdown

#### `app/api/webhook_sheets.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤ –æ—Ç Google Sheets

- –≠–Ω–¥–ø–æ–∏–Ω—Ç `POST /webhook/sheets`
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–∞ (`X-Webhook-Secret`)
- –ü–∞—Ä—Å–∏–Ω–≥ –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö (Pydantic –º–æ–¥–µ–ª—å `WebhookRow`)
- –ü–µ—Ä–µ–¥–∞—á–∞ –≤ `sheets_service.process_webhook_sheets()`

#### `app/api/webhook_amocrm.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤ –æ—Ç AmoCRM

- –≠–Ω–¥–ø–æ–∏–Ω—Ç `POST /webhook/amocrm`
- –ü–∞—Ä—Å–∏–Ω–≥ `application/x-www-form-urlencoded` —Ñ–æ—Ä–º–∞—Ç–∞ AmoCRM
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–¥–µ–ª–æ–∫ (`leads[update]`)
- –ü–µ—Ä–µ–¥–∞—á–∞ –≤ `amocrm_service.process_webhook_amocrm()`

#### `app/services/sheets_service.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ Google Sheets

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**

- `process_webhook_sheets()` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –≤–µ–±—Ö—É–∫–∞
- `_process_webhook_sheets_internal()` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞:
    - –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–∑–∞—â–∏—Ç–∞ –æ—Ç —Ü–∏–∫–ª–æ–≤)
    - –ß—Ç–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–æ–∫–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã
    - –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis-–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è —Å–¥–µ–ª–∫–∏
    - **–û–∂–∏–¥–∞–Ω–∏–µ 3 —Å–µ–∫—É–Ω–¥—ã** –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ —á—Ç–µ–Ω–∏–µ (–µ—Å–ª–∏ —Å–¥–µ–ª–∫–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è)
    - –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞ (`upsert_contact`)
    - –°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏ (`upsert_lead`)
    - –ó–∞–ø–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –æ–±—Ä–∞—Ç–Ω–æ –≤ —Ç–∞–±–ª–∏—Ü—É

**–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤:**

- –ì–∏–±—Ä–∏–¥–Ω–∞—è Redis-–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ `creating_lead:{row_index}` (TTL=10 —Å–µ–∫)
- –ï—Å–ª–∏ `amo_deal_id` —É–∂–µ –µ—Å—Ç—å ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è

#### `app/services/amocrm_service.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤ –æ—Ç AmoCRM

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**

- `process_webhook_amocrm()` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ `lead_id` –∏–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- –ü–æ–∏—Å–∫ —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ –ø–æ `amo_deal_id`
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ —Å–¥–µ–ª–∫–µ –∏ –∫–æ–Ω—Ç–∞–∫—Ç–µ –∏–∑ AmoCRM
- **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏** –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é –≤ —Ç–∞–±–ª–∏—Ü—É
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (`name`, `budget`, `status`, `phone`, `email`)

#### `app/services/import_service.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ–∏–º–ø–æ—Ä—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç—Ä–æ–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**

- `import_existing_rows()` ‚Äî —á–∏—Ç–∞–µ—Ç –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –±–µ–∑ `amo_deal_id`
- **–°–µ–º–∞—Ñ–æ—Ä** `asyncio.Semaphore(2)` ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞ (–º–∞–∫—Å–∏–º—É–º 2 —Å—Ç—Ä–æ–∫–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
- –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∏ —Å–¥–µ–ª–æ–∫ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏
- –ó–∞–ø–∏—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ —Ç–∞–±–ª–∏—Ü—É

**–ó–∞—â–∏—Ç–∞ –æ—Ç rate limiting:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ –±–æ–ª–µ–µ 2 —Å—Ç—Ä–æ–∫ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ AmoCRM API (429 Too
Many Requests).

#### `app/core/amocrm_client.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å AmoCRM API

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**

- `find_contact()` ‚Äî –ø–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –ø–æ email/—Ç–µ–ª–µ—Ñ–æ–Ω—É/–∏–º–µ–Ω–∏
- `upsert_contact()` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞
- `create_lead()` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å–¥–µ–ª–∫–∏
- `upsert_lead()` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏
- `get_lead_info()` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–¥–µ–ª–∫–µ
- `get_contact_info()` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–Ω—Ç–∞–∫—Ç–µ
- `lead_link()` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–¥–µ–ª–∫—É

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

- –í—Å–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã –æ–±–µ—Ä–Ω—É—Ç—ã –≤ `asyncio.to_thread()` –¥–ª—è –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–π —Ä–∞–±–æ—Ç—ã
- Retry-–º–µ—Ö–∞–Ω–∏–∑–º —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π (`@retry` –æ—Ç `tenacity`)
- –£–º–Ω—ã–π –ø–æ–∏—Å–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤: —Å–Ω–∞—á–∞–ª–∞ –ø–æ email (–±–æ–ª–µ–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π), –∑–∞—Ç–µ–º –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É

#### `app/core/sheets_client.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Google Sheets API

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**

- `read_all_rows()` ‚Äî —á—Ç–µ–Ω–∏–µ –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫ —Ç–∞–±–ª–∏—Ü—ã
- `update_cells()` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —è—á–µ–µ–∫ –≤ —Å—Ç—Ä–æ–∫–µ
- `find_row_by_deal_id()` ‚Äî –ø–æ–∏—Å–∫ —Å—Ç—Ä–æ–∫–∏ –ø–æ `amo_deal_id`

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `gspread` –±–∏–±–ª–∏–æ—Ç–µ–∫—É
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ–±–µ—Ä–Ω—É—Ç—ã –≤ `asyncio.to_thread()`
- Thread-safe –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ (`threading.Lock`)

#### `app/core/sync_lock.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** Redis-–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –≥–æ–Ω–æ–∫ –∏ —Ü–∏–∫–ª–æ–≤

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**

- `set_amocrm_to_sheets_lock(row_index, ttl=5)` ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –∏–∑ AmoCRM –≤ Sheets
- `check_amocrm_to_sheets_lock(row_index)` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –∏–∑ Sheets –≤ AmoCRM
- `_get_client()` ‚Äî –ª–µ–Ω–∏–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Redis –∫–ª–∏–µ–Ω—Ç–∞ —Å `asyncio.Lock`

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞—â–∏—Ç–∞ –æ—Ç —Ü–∏–∫–ª–æ–≤:**

1. AmoCRM –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–µ–±—Ö—É–∫ ‚Üí —Å–µ—Ä–≤–µ—Ä —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É ‚Üí –ø–∏—à–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü—É
2. Google Sheets –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–µ–±—Ö—É–∫ ‚Üí —Å–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É
3. –ß–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∏—Å—Ç–µ–∫–∞–µ—Ç ‚Üí —Å–ª–µ–¥—É—é—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ

#### `app/core/settings.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

- –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑ `.env` —á–µ—Ä–µ–∑ `pydantic-settings`
- –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π

#### `app/core/utils.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

- `normalize_phone(phone)` ‚Äî –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ `+`)
- `make_external_id(phone, email)` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID —Å—Ç—Ä–æ–∫–∏ (MD5 hash)

---

## –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

### Backend

| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è   | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                   |
|--------------|--------|------------------------------|
| **Python**   | 3.13+  | –û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫                |
| **FastAPI**  | 0.120+ | Web framework –¥–ª—è REST API   |
| **Uvicorn**  | 0.38+  | ASGI —Å–µ—Ä–≤–µ—Ä                  |
| **Pydantic** | 2.11+  | –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| **Redis**    | 7.0+   | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ |
| **asyncio**  | stdlib | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ |

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

| –°–µ—Ä–≤–∏—Å                | –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞          | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                           |
|-----------------------|---------------------|--------------------------------------|
| **Google Sheets API** | `gspread` 6.2+      | –ß—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å —Ç–∞–±–ª–∏—Ü                 |
| **Google Auth**       | `google-auth` 2.42+ | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Service Account |
| **AmoCRM API v2**     | `amocrm-api` 2.6+   | –†–∞–±–æ—Ç–∞ —Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ –∏ —Å–¥–µ–ª–∫–∞–º–∏       |

### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

- **tenacity** ‚Äî Retry-–º–µ—Ö–∞–Ω–∏–∑–º—ã –¥–ª—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –∫ —Å–µ—Ç–µ–≤—ã–º –æ—à–∏–±–∫–∞–º
- **python-dotenv** ‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–∑ `.env`
- **aiohttp** ‚Äî HTTP-–∫–ª–∏–µ–Ω—Ç (–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `amocrm-api`)

### Dev Tools

- **Black** ‚Äî –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
- **isort** ‚Äî –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤
- **Flake8** ‚Äî –õ–∏–Ω—Ç–µ—Ä (—Å—Ç–∏–ª—å –∫–æ–¥–∞)
- **Pylint** ‚Äî –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞
- **MyPy** ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
- **Pytest** ‚Äî –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Infrastructure

- **Docker / Docker Compose** ‚Äî –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è (Redis)
- **Poetry** ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- **Makefile** ‚Äî –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.13+
- Redis 7.0+ (–ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ Docker)
- Google Cloud Service Account —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ Google Sheets API
- AmoCRM –∞–∫–∫–∞—É–Ω—Ç —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π

### –®–∞–≥ 1: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone https://github.com/ZhulikovN/amocrm-gsheets-integration
```

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
poetry install

poetry shell
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å–∫ Redis

```bash
docker-compose up -d
```

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

### –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google Service Account

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Google Cloud Console](https://console.cloud.google.com/)
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç (–∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
3. –í–∫–ª—é—á–∏—Ç–µ **Google Sheets API**
4. –°–æ–∑–¥–∞–π—Ç–µ Service Account:
    - IAM & Admin ‚Üí Service Accounts ‚Üí Create Service Account
    - –°–∫–∞—á–∞–π—Ç–µ JSON-–∫–ª—é—á
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ JSON –≤ `secrets/`
6. **–î–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø Service Account –∫ —Ç–∞–±–ª–∏—Ü–µ:**
    - –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à—É Google –¢–∞–±–ª–∏—Ü—É
    - –ù–∞–∂–º–∏—Ç–µ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è"
    - –î–æ–±–∞–≤—å—Ç–µ email Service Account (–∏–∑ JSON: `client_email`)
    - –ü—Ä–∞–≤–∞: "–†–µ–¥–∞–∫—Ç–æ—Ä"

### –®–∞–≥ 6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ AmoCRM

1. –°–æ–∑–¥–∞–π—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –≤ AmoCRM:
    - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ ‚Üí –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
    - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `Client ID` –∏ `Client Secret`
    - –£–∫–∞–∂–∏—Ç–µ `Redirect URI` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://example.com/oauth/callback`)
    - –ü–æ–ª—É—á–∏—Ç–µ `Authorization Code` (–∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏) –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ `.env`:
    - `AMO_CLIENT_ID` ‚Äî Client ID –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
    - `AMO_CLIENT_SECRET` ‚Äî Client Secret –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
    - `AMO_AUTH_CODE` ‚Äî Authorization Code –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
    - `AMO_BASE_URL` ‚Äî URL –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ AmoCRM (–∏–∑ "–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏" ‚Üí "–ó–∞–≥–æ–ª–æ–≤–æ–∫")
    - `AMO_REDIRECT_URI` ‚Äî —Ç–æ—Ç –∂–µ Redirect URI, —á—Ç–æ —É–∫–∞–∑–∞–ª–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
    - `AMO_PIPELINE_ID` ‚Äî ID –≤–æ—Ä–æ–Ω–∫–∏, –≥–¥–µ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è —Å–¥–µ–ª–∫–∏
    - `AMO_STATUS_ID` ‚Äî ID —Å—Ç–∞—Ç—É—Å–∞ "–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞" –≤ –≤–æ—Ä–æ–Ω–∫–µ

3. **–¢–æ–∫–µ–Ω—ã —Å–æ–∑–¥–∞–¥—É—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ:**
    - –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏—è `init_token_manager()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `AMO_AUTH_CODE` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
    - –¢–æ–∫–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `.amocrm_tokens/`:
        - `access_token.txt`
        - `refresh_token.txt`
    - –í –¥–∞–ª—å–Ω–µ–π—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–∫–µ–Ω—ã —á–µ—Ä–µ–∑ Refresh Token

4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook –≤ AmoCRM:
    - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –í–µ–±—Ö—É–∫–∏ ‚Üí –î–æ–±–∞–≤–∏—Ç—å –≤–µ–±—Ö—É–∫
    - URL: `https://your-domain.com/webhook/amocrm`
    - –°–æ–±—ã—Ç–∏—è: "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏" (`leads[update]`)

### –®–∞–≥ 7: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google Apps Script

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à—É Google –¢–∞–±–ª–∏—Ü—É
2. –†–∞—Å—à–∏—Ä–µ–Ω–∏—è ‚Üí Apps Script
3. –í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥ –∏–∑ `scripts/apps_script.js`:

```javascript
const WEBHOOK_URL = "https://your-domain.com/webhook/sheets";
const WEBHOOK_SECRET = "your-super-secret-key-here";

function handleEdit(e) {
    try {
        if (!e || !e.range) {
            Logger.log("–°–æ–±—ã—Ç–∏–µ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç range");
            return;
        }

        Utilities.sleep(3000)

        const sheet = e.source.getActiveSheet();
        const row = e.range.getRow();
        if (row === 1) return;

        const headers = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
        const values = sheet.getRange(row, 1, 1, sheet.getLastColumn()).getValues()[0];

        const data = {};
        headers.forEach((header, i) => {
            data[header.trim().toLowerCase()] = values[i] ?? "";
        });

        const name = data.name || "";
        const phone = String(data.phone || "");
        const email = String(data.email || "");
        const budget = parseFloat(data.budget) || 0;
        const amoDealId = String(data.amo_deal_id || "");

        if (!name && !phone && !email) {
            Logger.log(`–ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ ${row} ‚Äî –ø—Ä–æ–ø—É—Å–∫`);
            return;
        }

        const payload = {
            row_index: row,
            data: {
                name,
                phone,
                email,
                budget,
                amo_deal_id: amoDealId,
                external_id: null
            }
        };

        const options = {
            method: "post",
            contentType: "application/json",
            headers: {
                "X-Webhook-Secret": WEBHOOK_SECRET
            },
            payload: JSON.stringify(payload),
            muteHttpExceptions: true
        };

        const response = UrlFetchApp.fetch(WEBHOOK_URL, options);
        const code = response.getResponseCode();
        const text = response.getContentText();

        if (code >= 200 && code < 300) {
            Logger.log(`–í–µ–±—Ö—É–∫ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –¥–ª—è —Å—Ç—Ä–æ–∫–∏ ${row}: ${code}`);
        } else {
            Logger.log(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å—Ç—Ä–æ–∫–∏ ${row}: ${code} ${text}`);
        }

    } catch (err) {
        Logger.log(`Exception: ${err.message}`);
    }
}
```

4. –¢—Ä–∏–≥–≥–µ—Ä—ã ‚Üí –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä:
    - –§—É–Ω–∫—Ü–∏—è: `handleEdit`
    - –°–æ–±—ã—Ç–∏—è: "–ü—Ä–∏ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"
    - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å

### –®–∞–≥ 8: –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
uvicorn app.main:app --reload --port 8000
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: `http://localhost:8080`

### –®–∞–≥ 9: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# Health check
curl http://localhost:8080/health

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å:
# {"status": "healthy"}
```

## –õ–æ–≥–∏–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –¥–∞–Ω–Ω—ã—Ö

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     GOOGLE SHEETS ‚Üí AmoCRM                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫—É –≤ Google Sheets
   ‚îÇ
   ‚îú‚îÄ> Google Apps Script –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ onEdit
   ‚îÇ
   ‚îú‚îÄ> Debounce: –∂–¥–µ—Ç 3 —Å–µ–∫—É–Ω–¥—ã (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –±—ã—Å—Ç—Ä—ã—Ö –ø—Ä–∞–≤–æ–∫)
   ‚îÇ
   ‚îú‚îÄ> POST /webhook/sheets
   ‚îÇ   Headers: X-Webhook-Secret
   ‚îÇ   Body: { row_index, data: { name, phone, email, budget, ... } }
   ‚îÇ
   ‚îî‚îÄ> FastAPI endpoint (webhook_sheets.py)
       ‚îÇ
       ‚îú‚îÄ> –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–∞
       ‚îÇ
       ‚îî‚îÄ> sheets_service.process_webhook_sheets()
           ‚îÇ
           ‚îú‚îÄ> –ü—Ä–æ–≤–µ—Ä–∫–∞ sync_lock (–∑–∞—â–∏—Ç–∞ –æ—Ç —Ü–∏–∫–ª–æ–≤)
           ‚îÇ   ‚îú‚îÄ> –ï—Å–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ ‚Üí SKIP (–Ω–µ–¥–∞–≤–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ –∏–∑ AmoCRM)
           ‚îÇ   ‚îî‚îÄ> –ò–Ω–∞—á–µ ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å
           ‚îÇ
           ‚îú‚îÄ> –ß—Ç–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–æ–∫–∏ –∏–∑ Google Sheets
           ‚îÇ   ‚îî‚îÄ> –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ existing_lead_id, existing_contact_id
           ‚îÇ
           ‚îú‚îÄ> –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis-–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ creating_lead:{row_index}
           ‚îÇ   ‚îú‚îÄ> –ï—Å–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ ‚Üí WAIT 3 —Å–µ–∫ ‚Üí –ø–µ—Ä–µ—á–∏—Ç–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É
           ‚îÇ   ‚îÇ   ‚îú‚îÄ> amo_deal_id –ø–æ—è–≤–∏–ª—Å—è ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∫–∞–∫ UPDATE
           ‚îÇ   ‚îÇ   ‚îî‚îÄ> amo_deal_id –Ω–µ –ø–æ—è–≤–∏–ª—Å—è ‚Üí SKIP
           ‚îÇ   ‚îî‚îÄ> –ò–Ω–∞—á–µ ‚Üí —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É (TTL=10 —Å–µ–∫)
           ‚îÇ
           ‚îú‚îÄ> Upsert –∫–æ–Ω—Ç–∞–∫—Ç–∞ –≤ AmoCRM
           ‚îÇ   ‚îú‚îÄ> find_contact(email, phone, name)
           ‚îÇ   ‚îÇ   ‚îú‚îÄ> –ü–æ–∏—Å–∫ –ø–æ email (–±–æ–ª–µ–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
           ‚îÇ   ‚îÇ   ‚îî‚îÄ> –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É (–µ—Å–ª–∏ email –Ω–µ –Ω–∞—à–µ–ª—Å—è)
           ‚îÇ   ‚îî‚îÄ> update_contact() –∏–ª–∏ create_contact()
           ‚îÇ
           ‚îú‚îÄ> Upsert —Å–¥–µ–ª–∫–∏ –≤ AmoCRM
           ‚îÇ   ‚îú‚îÄ> –ï—Å–ª–∏ existing_lead_id ‚Üí update_lead()
           ‚îÇ   ‚îî‚îÄ> –ò–Ω–∞—á–µ ‚Üí create_lead()
           ‚îÇ
           ‚îú‚îÄ> –ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å —Å–¥–µ–ª–∫–∏
           ‚îÇ   ‚îî‚îÄ> get_lead_info(lead_id) ‚Üí status_name
           ‚îÇ
           ‚îú‚îÄ> –ó–∞–ø–∏—Å–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ –≤ Google Sheets:
           ‚îÇ   ‚îî‚îÄ> { amo_deal_id, amo_contact_id, amo_link, status, external_id }
           ‚îÇ
           ‚îî‚îÄ> –°–Ω—è—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É creating_lead:{row_index}

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      AmoCRM ‚Üí GOOGLE SHEETS                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

1. –ú–µ–Ω–µ–¥–∂–µ—Ä –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–¥–µ–ª–∫—É –≤ AmoCRM (—Å—Ç–∞—Ç—É—Å, –±—é–¥–∂–µ—Ç, ...)
   ‚îÇ
   ‚îú‚îÄ> AmoCRM –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook
   ‚îÇ
   ‚îú‚îÄ> POST /webhook/amocrm
   ‚îÇ   Content-Type: application/x-www-form-urlencoded
   ‚îÇ   Body: leads[update][0][id]=12345&leads[update][0][status_id]=...
   ‚îÇ
   ‚îî‚îÄ> FastAPI endpoint (webhook_amocrm.py)
       ‚îÇ
       ‚îú‚îÄ> –ü–∞—Ä—Å–∏–Ω–≥ form data
       ‚îÇ
       ‚îî‚îÄ> amocrm_service.process_webhook_amocrm()
           ‚îÇ
           ‚îú‚îÄ> –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ lead_id –∏–∑ leads[update]
           ‚îÇ
           ‚îú‚îÄ> –ü–æ–∏—Å–∫ —Å—Ç—Ä–æ–∫–∏ –≤ Google Sheets –ø–æ amo_deal_id
           ‚îÇ   ‚îî‚îÄ> sheets_client.find_row_by_deal_id(lead_id)
           ‚îÇ
           ‚îú‚îÄ> –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ AmoCRM:
           ‚îÇ   ‚îú‚îÄ> get_lead_info(lead_id) ‚Üí name, budget, status_name, contact_id
           ‚îÇ   ‚îî‚îÄ> get_contact_info(contact_id) ‚Üí phone, email
           ‚îÇ
           ‚îú‚îÄ> –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (TTL=5 —Å–µ–∫)
           ‚îÇ   ‚îî‚îÄ> sync_lock.set_amocrm_to_sheets_lock(row_index)
           ‚îÇ
           ‚îú‚îÄ> –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ Google Sheets:
           ‚îÇ   ‚îî‚îÄ> { name, budget, status, phone, email }
           ‚îÇ
           ‚îî‚îÄ> –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å—Ç–µ–∫–∞–µ—Ç —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
               ‚îî‚îÄ> –°–ª–µ–¥—É—é—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ –±—É–¥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

–í—Å–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∑–∞–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è. –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫:

#### Google Sheets

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è                    | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –û–ø–∏—Å–∞–Ω–∏–µ                        | –ü—Ä–∏–º–µ—Ä                 |
|-------------------------------|-------------|---------------------------------|------------------------|
| `GOOGLE_SERVICE_ACCOUNT_JSON` | –î–∞          | –ü—É—Ç—å –∫ JSON —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ | `./secrets/sa.json`    |
| `GOOGLE_SPREADSHEET_ID`       | –î–∞          | ID —Ç–∞–±–ª–∏—Ü—ã (–∏–∑ URL)             | `1AbC...xyz`           |
| `GOOGLE_WORKSHEET_NAME`       | –ù–µ—Ç         | –ù–∞–∑–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–∞                  | `–õ–∏—Å—Ç1` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) |

#### AmoCRM

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è          | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –û–ø–∏—Å–∞–Ω–∏–µ                                                                       | –ü—Ä–∏–º–µ—Ä                               |
|---------------------|-------------|--------------------------------------------------------------------------------|--------------------------------------|
| `AMO_BASE_URL`      | –î–∞          | URL –∞–∫–∫–∞—É–Ω—Ç–∞ AmoCRM (–∏–∑ "–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏" ‚Üí "–ó–∞–≥–æ–ª–æ–≤–æ–∫")                    | `https://yoursubdomain.amocrm.ru`    |
| `AMO_CLIENT_ID`     | –î–∞          | Client ID –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (–∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)                                  | `xxxxxxxx-xxxx-xxxx-xxxx-...`        |
| `AMO_CLIENT_SECRET` | –î–∞          | Client Secret –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (–∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)                              | `YourClientSecretHere`               |
| `AMO_REDIRECT_URI`  | –î–∞          | Redirect URI, —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏                                | `https://example.com/oauth/callback` |
| `AMO_AUTH_CODE`     | –î–∞          | Authorization Code (–∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)                    | `def502...`                          |
| `AMO_ACCESS_TOKEN`  | –ù–µ—Ç         | Access Token (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –≤ `.amocrm_tokens/`)  | -                                    |
| `AMO_REFRESH_TOKEN` | –ù–µ—Ç         | Refresh Token (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –≤ `.amocrm_tokens/`) | -                                    |
| `AMO_PIPELINE_ID`   | –î–∞          | ID –≤–æ—Ä–æ–Ω–∫–∏, –≥–¥–µ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è —Å–¥–µ–ª–∫–∏                                       | `1234567`                            |
| `AMO_STATUS_ID`     | –î–∞          | ID —Å—Ç–∞—Ç—É—Å–∞ "–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞" –≤ –≤–æ—Ä–æ–Ω–∫–µ                                            | `7654321`                            |

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** `AMO_ACCESS_TOKEN` –∏ `AMO_REFRESH_TOKEN` —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑
`AMO_AUTH_CODE`. –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ–Ω–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ñ–∞–π–ª–∞—Ö `.amocrm_tokens/access_token.txt` –∏
`.amocrm_tokens/refresh_token.txt`, –∏ –≤ `.env` –∏—Ö —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.

#### Application

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è       | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –û–ø–∏—Å–∞–Ω–∏–µ                      | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------------|-------------|-------------------------------|--------------|
| `APP_HOST`       | –ù–µ—Ç         | –•–æ—Å—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è               | `0.0.0.0`    |
| `APP_PORT`       | –ù–µ—Ç         | –ü–æ—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è               | `8080`       |
| `LOG_LEVEL`      | –ù–µ—Ç         | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è           | `INFO`       |
| `WEBHOOK_SECRET` | –î–∞          | –°–µ–∫—Ä–µ—Ç –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤–µ–±—Ö—É–∫–æ–≤ | -            |

#### Redis

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è       | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –û–ø–∏—Å–∞–Ω–∏–µ             | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------------|-------------|----------------------|--------------|
| `REDIS_HOST`     | –ù–µ—Ç         | –•–æ—Å—Ç Redis           | `localhost`  |
| `REDIS_PORT`     | –ù–µ—Ç         | –ü–æ—Ä—Ç Redis           | `6379`       |
| `REDIS_DB`       | –ù–µ—Ç         | –ù–æ–º–µ—Ä –ë–î Redis       | `0`          |
| `REDIS_PASSWORD` | –ù–µ—Ç         | –ü–∞—Ä–æ–ª—å Redis         | `None`       |
| `SYNC_LOCK_TTL`  | –ù–µ—Ç         | TTL –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (—Å–µ–∫) | `10`         |

### Makefile –∫–æ–º–∞–Ω–¥—ã

```bash
# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
make format

# –õ–∏–Ω—Ç–∏–Ω–≥
make lint

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ + –õ–∏–Ω—Ç–∏–Ω–≥
make format && make lint

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
make test
```

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –∞–≤—Ç–æ—Ä

**–ê–≤—Ç–æ—Ä:** Nikita Zhulikov  
**Email:** zhulikovnikita884@gmail.com  
**GitHub:** https://github.com/ZhulikovN
